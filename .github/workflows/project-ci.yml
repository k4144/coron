name: project-ci

on: [push, pull_request, workflow_dispatch]

env:
  PYTHON_VERSION: "3.11"
  PUBLISH_ON: "main"

permissions:
  contents: write

jobs:
  pipeline:
    uses: ./.github/workflows/reusable-python-package.yml
    with:
      python-version: ${{ env.PYTHON_VERSION }}
      package-name: "coron"
      publish-on: ${{ env.PUBLISH_ON }}

  publish:
    needs: pipeline
    if: needs.pipeline.outputs.should_publish == 'true'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    environment: pypi
    steps:
      - name: Download distribution artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ needs.pipeline.outputs.dist_artifact }}
          path: dist

      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          packages-dir: dist/
